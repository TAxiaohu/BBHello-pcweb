<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>支付体检费用</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="51二胎">
        <meta name="keywords" content="51二胎">
        <meta name="author" content="51二胎">
        <!-- Site CSS -->
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="../js/lib/html5shiv.min.js"></script>
          <script src="../js/lib/respond.min.js"></script>
        <![endif]-->
        <!-- <link rel="canonical" href="http://www.bootcss.com/"> -->
        <link rel="stylesheet" href="../css/bootstrap.min.css">
        <link rel="stylesheet" href="../css/page.css">
        <link rel="stylesheet" href="../css/pay.css">
    </head>
    <body>
        <div id="page-pay">
            <nav class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand hidden-sm" >
                            <img alt="51二胎" src="../img/logo-white.png">
                        </a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav navbar-right hidden-xs" id="loged" style="display: none;"> 
                            <li><a id="my-name" href="my.html" style="color: #fff;"></a></li>
                            <li><div class="avatar"><img id="my-avatar" src="../img/avatar.png" width="40px"><div class="down-triangle"></div></div></li>
                        </ul>
                        <div class="container" style="position: absolute;">
                            <div class="down-menu">
                                <div class='up-triangle'></div>
                                <a href='my.html#order' onclick="anchorLink()">我的订单</a>
                                <a href='my.html#account' onclick="anchorLink()">账户设置</a>
                                <a onclick="quit()">退出</a>
                            </div>
                        </div>
                    </div><!-- /.navbar-collapse -->
                </div><!-- /.container-fluid -->
            </nav>
            <div class="container wrap">
                <h3 class="color-blue header-title">支付体检费用</h3>
                <div class="seller-detail">
                    <div class="s-name">泰国贴心体检旅游套餐</div>
                    <div class="s-price color-blue">¥<span class="big-font">9800</span>元</div>
                </div>
                <div class="pay-box row">
                    <h3>微信支付</h3>
                    <div class="col-xs-6 wcpay" align="center">
                        <div class="pay-wrap">
                            <div class="wc-logo"><img src="../img/icon-pay-wechat.png" width="25px" style="margin-right: 10px">微信支付</div>
                            <div class="wc-qrcode">
                                <img src="../img/qrcode.jpg">
                            </div>
                            <div class="pay-tip">请使用微信扫描二维码以完成支付</div>
                        </div>
                    </div>
                    <div class="col-xs-6" id="mobile-img" style="padding-left: 5%">
                        <img class="mbl-img" src="../img/pic-pay-mobile.png">
                    </div>
                </div>
            </div>
            <div class="container" id="customer-service" align="center" style="background-color: #fff;">
                <img src="../img/logo-white.png">
                <h3>在线客服</h3>
                <div style="padding: 0 15px;">
                <ul class="list-unstyled">
                    <li><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=2532535151&site=qq&menu=yes">客服01号</a></li>
                    <li><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=2602605151&site=qq&menu=yes">客服02号</a></li>
                </ul>
                </div>
                <p class="color-gray">客服热线</p>
                <p class="color-blue">400-136-5151</p>
            </div>
            <div id="mob-ctm-svc">
                <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=2532535151&site=qq&menu=yes"><img src="../img/pic-ctm-svc.png"></a>
            </div>
            <footer>
                <div class="footer-bottom">
                    <div class="container">
                        <div class="brand-info">
                            <img src="../img/logo-white.png">
                            <p>Copyright &copy; 2015 - 2016, 51二胎&reg;, All Rights Reserved. <a href="http://www.miibeian.gov.cn/">粤ICP备16027439号</a></p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
        <a href="#modal-success" class="btn btn-primary" role="button" id="success" data-toggle="modal" data-target="#modal-success" style="display: none;">成功</a>
        <div class='modal fade' id='modal-success' align='center'>
            <div class='modal-box' height='100%'>
                <a class='close' data-dismiss='modal'>
                    <img src='../img/icon-sdblock-btnclose.png'>
                </a>
                <div class="wrapper" align="center" style="margin-top: 10px;">
                    <img width="80px" src="../img/icon-sdblock-yes.png">
                    <h4 style="font-size: 180%;margin-top: 30px;margin-bottom: 20px;">支付成功</h4>
                    <p>工作人员将会尽快联系您，<br/>请保持您的电话畅通。</p>
                    <div class="btn-submit">
                        <a class='btn btn-primary' role='button' id='success-sbm'>确定</a>
                    </div>
                </div>
            </div>
        </div>
        <script src="../js/lib/jquery.min.js"></script>
        <script type="text/javascript" src="../js/service.js"></script>
        <script type="text/javascript" src="../js/data.js"></script>
        <script type="text/javascript" src="../js/lib/bootstrap.min.js"></script>
        <script type="text/javascript" src="../js/main.js"></script>
        <script type="text/javascript">
            var tradeId = urlUtil.getQueryString("tradeId");
            var orderId = urlUtil.getQueryString("orderId");
            var id = urlUtil.getQueryString("goodId");
            var data = {};
            var c = 120;
            var sc = 10;
            data.outTradeNo = tradeId;
            for (i=0;i<seller.sellers.length;i++) {
                if (id == seller.sellers[i].id) {
                    context = seller.sellers[i];
                }
            }
            if (id !== "4") {
                $(".s-name").html(context.name + " - 泰国体检");
            } else {
                $(".s-name").html(context.name);
            }
            $(".s-price span").html(context.amount);
            wcGetQrcodeApi(data,function(res){
                if (res.code === '200' && res.data) {
                    var baseCode = res.data;
                    $(".wc-qrcode img").attr("src","data:image/png;base64,"+res.data);
                } else {
                    alert(res.message);
                }
            });
            // 支付页刷新二维码
            function refreshQrcode(){ 
                c = c-1;
                console.log(c);
                t = setTimeout("refreshQrcode()",1000);
                if (c==0) {
                    wcGetQrcodeApi(data,function(res){
                        if (res.code === '200' && res.data) {
                            var baseCode = res.data;
                            $(".wc-qrcode img").attr("src","data:image/png;base64,"+res.data);
                        } else {
                            alert(res.message);
                        }
                    });
                    c=120;
                }
            }
            refreshQrcode();
            // 支付页刷新支付状态
            function refreshStatus(){ 
                sc = sc-1;
                console.log(sc);
                st = setTimeout("refreshStatus()",1000);
                if (sc==0) {
                    orderGetStatusApi(orderId,function(res){
                        if (res.code === '200' && res.data) {
                            if (res.data == "1"){
                                clearTimeout(t);
                                clearTimeout(st);
                                $("#success").trigger("click");
                                $("#success-sbm").click(function(){
                                    window.location.href="my.html";
                                })
                            }
                        } else {
                            alert(res.message);
                        }
                    });
                    sc=10;
                }
            }
            refreshStatus();
        </script>
    </body>
</html>